package algorithm

import (
	"fmt"
	emsbase "quant/emsmodule/base"
)

type Common struct {
	adaptersMap map[string]emsbase.ITarde
}

func (c *Common) Trade(p emsbase.Portfolio) error {
	for _, e := range p.SecurityEntrusts {
		if e.Algorithm == "" {
			itrade, ok := c.adaptersMap[p.AdapterName]
			if ok {
				go itrade.LimitEntrust(e, p.AccountID, p.CombiNo)
			} else {
				return &emsbase.RespError{ErrorMsg: fmt.Sprintf("Common algorithm: can't find \"%s\" trade adapter.", p.AdapterName)}
			}
		}
	}
	return nil
}
